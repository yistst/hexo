<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>在手机里安装alpine做服务器 · 歸海.</title><meta name="description" content="前言之前一直用Debian系列的服务器，因为习惯了apt软件包管理，之前一直想尝试centos实在用不惯yun以至于用了两年的debian，现在服务器空间越来越吃紧了于是想把系统换成alpine
部署与配置先到手机Termux官网下载软件安装
打开Termux后替换包源码
sed -i 's@^\("><meta name="og:description" content="前言之前一直用Debian系列的服务器，因为习惯了apt软件包管理，之前一直想尝试centos实在用不惯yun以至于用了两年的debian，现在服务器空间越来越吃紧了于是想把系统换成alpine
部署与配置先到手机Termux官网下载软件安装
打开Termux后替换包源码
sed -i 's@^\("><meta name="twitter:site" content="歸海."><meta name="twitter:title" content="在手机里安装alpine做服务器"><meta name="twitter:card" content="summary"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/hexo/css/bootstrap.min.css"><link rel="stylesheet" href="/hexo/css/font-awesome.min.css"><link rel="stylesheet" href="/hexo/css/style-dark.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 6.0.0"><link rel="stylesheet" href="/hexo/css/prism.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/hexo/" class="a-title">歸海</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/hexo/" class="a-title">歸於珊海.</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/hexo/">首页</a></li><li><a href="/hexo/archives">归档</a></li><li><a href="/hexo/tags">标签</a></li><li class="soc"><a href="http://example.com/atom.xml" target="_blank" rel="noopener noreferrer" aria-label="RSS"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2022&nbsp;<a target="_blank" href="http://example.com" rel="noopener noreferrer">Yi</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>在手机里安装alpine做服务器</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2022-01-11</span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/hexo/tags/Linux/" title="Linux" class="a-tag">Linux</a><span>&nbsp;</span></span></p><p class="post-abstract"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>之前一直用Debian系列的服务器，因为习惯了apt软件包管理，之前一直想尝试centos实在用不惯yun以至于用了两年的debian，现在服务器空间越来越吃紧了于是想把系统换成<a target="_blank" rel="noopener" href="https://www.alpinelinux.org/">alpine</a></p>
<h3 id="部署与配置"><a href="#部署与配置" class="headerlink" title="部署与配置"></a>部署与配置</h3><p>先到手机<a target="_blank" rel="noopener" href="https://f-droid.org/packages/com.termux/">Termux</a>官网下载软件安装</p>
<p>打开Termux后替换包源码</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">sed</span> -i <span class="token string">'s@^\(deb.*stable main\)<span class="token variable">$@deb</span> https://mirrors.tuna.tsinghua.edu.cn/termux/termux-packages-24 stable main@'</span> <span class="token variable">$PREFIX</span>/etc/apt/sources.list
</code></pre>
<p>把软件源换成国内<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%80%E6%BA%90%E9%95%9C%E5%83%8F%E7%AB%99/7395020">清华镜像站</a>这样可以加速安装软件</p>
<p>无root权限无法使用tsu则不需要安装tsu。</p>
<pre class=" language-bash"><code class="language-bash">pkg update
pkg <span class="token function">install</span> -y tsu proot <span class="token function">wget</span>
</code></pre>
<p>有没有root权限其实相差并不大，只不过安卓10开始WEB服务的默认80端口无法开启，要么修改端口为1024以上，要么启用root权限进行服务。</p>
<p>接下来在home目录里创建一个文件夹用于存放<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B2%99%E7%9B%92/3769297">沙盒系统</a></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> rootfs <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> rootfs

<span class="token comment" spellcheck="true">#这里的root是文件夹名称，随意定义</span>

curl -<span class="token comment" spellcheck="true"># -O https://mirrors.tuna.tsinghua.edu.cn/lxc-images/images/alpine/3.15/arm64/default/20220110_13%3A00/rootfs.tar.xz</span>

<span class="token comment" spellcheck="true">#这边直接用Termux自带的curl缓存rootfs压缩文件</span>
<span class="token comment" spellcheck="true">#用浏览器打开mirrors.tuna.tsinghua.edu.cn/lxc-images/images选择其它系统文件</span>

<span class="token function">tar</span> xpf rootfs.tar.xz <span class="token comment" spellcheck="true">#解压文件</span>
</code></pre>
<p>用 <code>ls</code> 查看有如下文件夹</p>
<p><code>bin  etc   lib    mnt  proc  run   srv  tmp  var dev  home  media  opt  root  sbin  sys  usr</code><br>接下来就是用脚本引用启动这个沙盒了，都知道除了 <code>proot</code> 还有个 <code>chroot</code> 为什么只用 <code>proot</code> 呢<br>原因其实很简单 <code>chroot</code> 需要用Root权限，很多人手机都没有所以劝退🙄</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#!/data/data/com.termux/files/usr/bin/bash </span>
user<span class="token operator">=</span><span class="token string">"root"</span>
f<span class="token operator">=</span><span class="token string">"rootfsfs"</span>
h<span class="token operator">=</span><span class="token string">"/root"</span>
unset LD_PRELOAD
c<span class="token operator">=</span><span class="token string">"proot"</span>
c+<span class="token operator">=</span><span class="token string">" --link2symlink"</span>
c+<span class="token operator">=</span><span class="token string">" -0"</span>
c+<span class="token operator">=</span><span class="token string">" -r  <span class="token variable">$f</span>"</span>
c+<span class="token operator">=</span><span class="token string">" -b /dev"</span>
c+<span class="token operator">=</span><span class="token string">" -b /proc"</span>
c+<span class="token operator">=</span><span class="token string">" -b  <span class="token variable">$f</span><span class="token variable">$h</span>:/dev/shm"</span>
<span class="token comment" spellcheck="true">#您可以在此处修改挂载目录</span>
c+<span class="token operator">=</span><span class="token string">" -b /sdcard/:/mnt/sdcard/"</span>

c+<span class="token operator">=</span><span class="token string">" -w <span class="token variable">$h</span>"</span>
c+<span class="token operator">=</span><span class="token string">" /usr/bin/env -i"</span>
c+<span class="token operator">=</span><span class="token string">" HOME=<span class="token variable">$h</span>"</span>
c+<span class="token operator">=</span><span class="token string">" PATH=/usr/local/sbin:/usr/local/bin:/bin:/usr/bin:/sbin:/usr/sbin:/usr/games:/usr/local/games"</span>
c+<span class="token operator">=</span><span class="token string">" TERM=xterm-256color"</span>
<span class="token comment" spellcheck="true">#c+=" LANG=zh_CN.UTF-8"</span>
c+<span class="token operator">=</span><span class="token string">" /bin/ash --login"</span>
com<span class="token operator">=</span><span class="token string">"<span class="token variable">$@</span>"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
<span class="token function">exec</span> <span class="token variable">$c</span>
<span class="token keyword">else</span>
<span class="token variable">$c</span> -c <span class="token string">"<span class="token variable">$c</span>"</span>
<span class="token keyword">fi</span>
</code></pre>
<p>将脚本写入<code>alpine.sh</code>文件里</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">chmod</span> +x alpine.sh
<span class="token function">bash</span> alpine.sh
</code></pre>
<p>如果有Root权限的直接输入<code>tsu</code>再执行<code>bash alpine.sh</code></p>
<p>接下来我们就可以进入刚刚安装好的系统里<br>虽然已经安装好了，但是没办法联网安装软件，还要配置一些文件</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">rm</span> -rf /etc/resolv.conf
<span class="token function">touch</span> /etc/resolv.conf 
<span class="token keyword">echo</span> <span class="token string">"nameserver 0.0.8.8
nameserver 8.8.8.8"</span> <span class="token operator">></span>/etc/resolv.conf
<span class="token comment" spellcheck="true">#这时候可以联网，但官方软件地址速度很慢，所以继续换源</span>

<span class="token function">sed</span> -i <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g'</span> /etc/apk/repositories
<span class="token comment" spellcheck="true">#把dl-cdn.alpinelinux.org替换成mirrors.tuna.tsinghua.edu.cn</span>

apk update
apk upgrade 
apk add <span class="token function">wget</span> vim
</code></pre>
<p>安装<code>Apache2 PHP</code></p>
<pre class=" language-bash"><code class="language-bash">apk add php-apache2 php-pdo php-mbstring php-gd php-dom php-pear php-pdo_mysql php-session php-simplexml php-gmp php-sockets php-json php-gettext php-iconv php-ctype php-curl php-exif php-ftp php-fileinfo php-intl php-ldap php-mysqli php-zip php-bz2

<span class="token keyword">echo</span> <span class="token string">"LoadModule php7_module modules/mod_php7.so
LoadModule rewrite_module modules/mod_rewrite.so"</span> <span class="token operator">>></span> /etc/apache2/httpd.conf

<span class="token comment" spellcheck="true">#如果不是用tsu启动的还要再修改一下端口</span>
<span class="token function">sed</span> -i <span class="token string">'s/Listen 80/Listen 8080/g'</span> /etc/apache2/httpd.conf
</code></pre>
<p>现在可以启动服务<code>rc-service apache2 start</code>很不幸回车后警告服务运行中，这时你打开浏览器<a href="127.0.0.1">localhost</a>发现服务没运行啊？所以得重载一下</p>
<pre class=" language-bash"><code class="language-bash">rc-status
<span class="token function">touch</span> /run/openrc/softlevel
</code></pre>
<p>启动服务<code>rc-service apache2 start</code>现在可以了<br><a href="127.0.0.1">localhost</a><br><a href="127.0.0.1:8080">localhost:8080</a><br>这时打开链接就可以看到成果了</p>
<p>配置PHP上传文件的大小限制</p>
<pre class=" language-bash"><code class="language-bash">vim /etc/php7/php.ini

post_max_size <span class="token operator">=</span> 2M Post最大限制
upload_max_filesize <span class="token operator">=</span> 2M 上传文件的最大限制
max_file_uploads <span class="token operator">=</span> 20 最大并发上传数量
</code></pre>
<p>当然了有些项目要用到数据库<code>Mysql</code>or<code>Mariadb</code>所以我们还要安装一个<code>Mysql</code></p>
<pre class=" language-bash"><code class="language-bash">apk add mysql mysql-client

<span class="token function">passwd</span> root <span class="token comment" spellcheck="true">#修改一下登入密码</span>

rc-service mariadb start

mysql_secure_installation <span class="token comment" spellcheck="true">#初始化数据库</span>
</code></pre>
<pre><code>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!
注意:运行这个脚本的所有部分是所有MariaDB推荐
服务器在生产使用!请仔细阅读每一步!

In order to log into MariaDB to secure it, we&#39;ll need the current
password for the root user. If you&#39;ve just installed MariaDB, and
haven&#39;t set the root password yet, you should just press enter here.
为了登录MariaDB安全,我们需要的登入
根用户密码。如果你刚刚安装MariaDB,
还没有设置root密码,你应该在这里按回车。

Enter current password for root (enter for none):
输入当前密码为根(没有设置按回车): ***
</code></pre>
<pre><code>Setting the root password or using the unix_socket ensures that nobody
can log into the MariaDB root user without the proper authorisation.
设置root密码或使用unix_socket确保没人
可以登录到MariaDB根用户没有适当的授权。

You already have your root account protected, so you can safely answer &#39;n&#39;.
你已经有根帐户保护,所以你可以放心地回答“n”。

Switch to unix_socket authentication [Y/n]
切换到unix_socket认证[是/否]
</code></pre>
<pre><code>You already have your root account protected, so you can safely answer &#39;n&#39;.
你已经有根帐户保护,所以你可以放心地回答“n”。

Change the root password? [Y/n]
改变根密码?[是/否]
</code></pre>
<pre><code>By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.
默认情况下,MariaDB安装有一个匿名用户,允许任何人
登录MariaDB而无需创建用户帐户
他们。这个目的是只用于测试,安装
去更平缓一些。你应该进入前删除它们
生产环境。

Remove anonymous users?[Y/n]
删除匿名用户?[是/否]
</code></pre>
<pre><code>Normally, root should only be allowed to connect from &#39;localhost&#39;.  This
ensures that someone cannot guess at the root password from the network.
正常情况下,Root用户只允许连接“本地localhost”。这
确保坏人不能猜测网络的root密码。

Disallow root login remotely? [Y/n]
不允许远程root登录吗?[是/否]
</code></pre>
<pre><code>By default, MariaDB comes with a database named &#39;test&#39; that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.
默认情况下,MariaDB附带了一个名为“测试”的数据库,任何人都可以，访问。这也是只有测试,并且应该被删除，之前移动到生产环境中。

Remove test database and access to it? [Y/n]
删除测试数据库和访问吗?[是/否]
</code></pre>
<pre><code>Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.
重新加载权限表将确保所有到目前为止所做的更改将立即生效。

Reload privilege tables now? [Y/n]
现在重新加载权限表吗?[是/否]
</code></pre>
<pre><code>Cleaning up...
清理....

All done!  If you&#39;ve completed all of the above steps, your MariaDB
installation should now be secure.
全部完成!如果你已经完成了以上步骤,MariaDB安装现在应该安全。

Thanks for using MariaDB!
感谢使用MariaDB!
</code></pre>
<p>根据提示进行设置，完成后接下去创建数据库</p>
<pre class=" language-bash"><code class="language-bash">mysql -u root -p
<span class="token comment" spellcheck="true">#输入密码或者回车登入</span>

create database name <span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">#创建数据库</span>
drop database name<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">#删除数据库</span>
<span class="token comment" spellcheck="true">#show databases;</span>
列出所有数据库

mysqldump -u 用户名 -p 数据库名 <span class="token operator">></span> 数据库文件名.sql
<span class="token comment" spellcheck="true">#导出数据库</span>

mysql -u用户名 -p 数据库名 <span class="token operator">&lt;</span> 数据库文件名.sql
<span class="token comment" spellcheck="true">#导入数据库</span>
</code></pre>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a target="_blank" rel="noopener" href="http://twitter.com/home?status=http://example.com/2022/01/11/alpine沙盒/%20歸海.%20在手机里安装alpine做服务器" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/hexo/2022/01/14/%E7%94%A8Aria+AriaNg+OneDrive+Rclone%E5%81%9A%E8%B5%84%E6%BA%90%E7%9B%98/" title="Rclone+OneDrive+Aria2"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: Rclone+OneDrive+Aria2</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/hexo/2021/04/16/%E9%93%BE%E6%8E%A5%E8%8E%B7%E5%8F%96QQ%E5%A4%B4%E5%83%8F/" title="链接获取QQ头像">下一篇: 链接获取QQ头像&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2022&nbsp;<a target="_blank" href="http://example.com" rel="noopener noreferrer">Yi</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/hexo/js/jquery-3.1.0.min.js"></script><script src="/hexo/js/bootstrap.min.js"></script><script src="/hexo/js/jquery-migrate-1.2.1.min.js"></script><script src="/hexo/js/jquery.appear.js"></script><script src="/hexo/js/google-analytics.js"></script><script src="/hexo/js/typography.js"></script></body></html>